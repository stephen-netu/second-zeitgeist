<!-- Native Jekyll Timeline -->
<section id="timeline" class="timeline-section">
  <h2>Our Journey</h2>
  <div class="timeline-filters no-print" aria-label="Filter timeline by facet" style="margin-bottom: 1rem;">
    <strong style="margin-right: 0.5rem;">Filter:</strong>
    <span class="facets"></span>
    <button type="button" class="clear-filters" style="margin-left: 0.5rem;">Clear</button>
  </div>
  <div class="timeline-container native-timeline">
    <div class="timeline-line"></div>
    {% assign events = site.data.epistemology | default: site.data.timeline | sort: 'date' %}
    {% for event in events %}
      <div class="timeline-event" data-facets="{% if event.facets %}{{ event.facets | join: ',' }}{% endif %}">
        <div class="timeline-dot"></div>
        <div class="timeline-content">
          <h3 class="event-title">{{ event.title }}</h3>
          <div class="event-period">
            <span class="event-date">{{ event.date }}</span>
            {% if event.end_date and event.end_date != event.date %}
            <span class="event-separator">â€”</span>
            <span class="event-end-date">{{ event.end_date }}</span>
            {% endif %}
          </div>
          {% if event.claim %}
          <p class="event-claim"><em>{{ event.claim }}</em></p>
          {% endif %}
          {% if event.criteria_failed %}
          <p class="event-criteria">
            {% for c in event.criteria_failed %}
              <span class="criteria-badge">{{ c }}</span>
            {% endfor %}
          </p>
          {% endif %}
          <p class="event-description">{{ event.description }}</p>
          {% if event.evidence %}
          <p class="event-evidence">Evidence: {{ event.evidence }}</p>
          {% endif %}
          {% if event.sources %}
          <p class="event-sources">Sources:
            {% for s in event.sources %}
              <a href="{{ s.url | default: s }}" target="_blank" rel="noopener">{{ s.title | default: s }}</a>{% unless forloop.last %}, {% endunless %}
            {% endfor %}
          </p>
          {% endif %}
          {% if event.impact %}
          <p class="event-impact"><strong>Impact:</strong> {{ event.impact }}</p>
          {% endif %}
        </div>
      </div>
    {% endfor %}
  </div>
  <p class="timeline-note">This native timeline is sourced from YAML data in <code>_data/epistemology.yml</code> (or <code>_data/timeline.yml</code>) for easy customization and annotation. The Interactive view still uses the KnightLab Google Sheet.</p>

  <script>
    (function(){
      const container = document.currentScript && document.currentScript.parentElement;
      if (!container) return;
      const events = container.querySelectorAll('.timeline-event');
      const facetsSpan = container.querySelector('.timeline-filters .facets');
      const clearBtn = container.querySelector('.timeline-filters .clear-filters');
      if (!facetsSpan || !clearBtn) return;
      // Collect unique facets
      const facetSet = new Set();
      events.forEach(ev => {
        const facets = (ev.getAttribute('data-facets')||'').split(',').map(s=>s.trim()).filter(Boolean);
        facets.forEach(f=>facetSet.add(f));
      });
      // Build checkboxes
      const selected = new Set();
      facetSet.forEach(f => {
        const id = 'facet-'+f.replace(/[^a-z0-9_-]/gi,'').toLowerCase();
        const label = document.createElement('label');
        label.style.marginRight = '8px';
        const cb = document.createElement('input');
        cb.type = 'checkbox';
        cb.value = f;
        cb.id = id;
        cb.addEventListener('change', () => {
          if (cb.checked) selected.add(f); else selected.delete(f);
          applyFilter();
        });
        label.appendChild(cb);
        const text = document.createTextNode(' '+f);
        label.appendChild(text);
        facetsSpan.appendChild(label);
      });
      clearBtn.addEventListener('click', () => {
        selected.clear();
        facetsSpan.querySelectorAll('input[type="checkbox"]').forEach(cb=>cb.checked=false);
        applyFilter();
      });
      function applyFilter(){
        if (selected.size === 0){
          events.forEach(ev => ev.style.display = '');
          return;
        }
        events.forEach(ev => {
          const facets = (ev.getAttribute('data-facets')||'').split(',').map(s=>s.trim()).filter(Boolean);
          const hasAll = [...selected].every(f => facets.includes(f));
          ev.style.display = hasAll ? '' : 'none';
        });
      }
    })();
  </script>
</section>
 
 